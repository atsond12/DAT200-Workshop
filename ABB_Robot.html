<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="./favicon.ico" />
    <title>ABB Robot</title>

    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
    </style>

    <!-- Import map: map the bare specifier "three" to the local module build. -->
    <script type="importmap">
      {
        "imports": {
          "three": "./lib/three.js-master/build/three.module.js",
          "OrbitControls": "./lib/three.js-master/examples/jsm/controls/OrbitControls.js",
          "dat.GUI": "./lib/dat.gui/dat.gui.module.js",
          "Stats": "./lib/three.js-master/examples/jsm/libs/stats.module.js",
          "GLTFLoader": "./lib/three.js-master/examples/jsm/loaders/GLTFLoader.js"
        }
      }
    </script>
  </head>
  <body>
  <script type="module" defer>
      import { world } from "./simpleWorld.js";
      import * as THREE from "three";
      import { GLTFLoader } from "GLTFLoader";

      const deg = Math.PI/180;
      const abbModel = {};
      //----- Functions -----------------------------------------

      function ABBModelObjectLoad(aObject){
        if(aObject.isMesh){
          aObject.castShadow = true;
          aObject.receiveShadow = true;
        }else if(aObject.isGroup){
          abbModel[aObject.name] = aObject;
        }
       }

      function ABBModelOnLoad(aGLTF){
        console.log("ABB model loading . . ." + aGLTF.toString());
        const abbRobot = aGLTF.scene;
        aGLTF.scene.traverse(ABBModelObjectLoad);
        abbRobot.scale.set(7, 7, 7);
        world.scene.add(abbRobot);
        setInterval(animate, 20);
      }

      function addSpotLight(){
        const light = new THREE.SpotLight("#FFFFFF", 20);
        light.position.set(2, 25, 2);
        light.angle = 30 * deg;
        light.distance = 50;
        light.decay = 1;
        //Shadow options
        light.castShadow = true;
        light.penumbra = 0.5;
        light.shadow.bias = -0.0005;

        const target = new THREE.Object3D();
        target.position.set(0, 0, 0);
        world.scene.add(target);
        light.target = target;
        world.scene.add(light);
        const helper = new THREE.SpotLightHelper(light);
        world.scene.add(helper);

      }

      function animate(){
        abbModel["Link_01"].rotation.y += 1 * deg;
      }

      //----- Main Code ------------------------------------------
      const loader = new GLTFLoader();

      addSpotLight();
      loader.load("./models/robot/ABB_Robot_01.gltf", ABBModelOnLoad)

      document.body.appendChild(world.renderer.domElement);
    </script>
  </body>
</html>
